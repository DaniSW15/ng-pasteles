<div class="users-page">
  <div class="page-header">
    <h1>Gestión de Usuarios</h1>
    <p-button 
      label="Crear Usuario" 
      icon="pi pi-plus" 
      (onClick)="openCreateDialog()"
    />
  </div>

  <div class="page-content">
    @if (store.loading()) {
      <app-loading-spinner />
    } @else if (store.error()) {
      <div class="error-message">
        <i class="pi pi-exclamation-triangle"></i>
        <p>{{ store.error() }}</p>
      </div>
    } @else {
      <app-data-table
        [data]="store.users()"
        [columns]="columns"
        (rowDelete)="onUserDelete($event)"
      />
    }
  </div>
</div>

<!-- Dialog para crear usuario -->
<p-dialog 
  [(visible)]="showDialog" 
  [modal]="true"
  [style]="{ width: '500px' }"
  header="Crear Nuevo Usuario"
>
  <form [formGroup]="userForm" (ngSubmit)="onSubmit()">
    <!-- Nombre -->
    <div class="field">
      <label for="nombre">Nombre *</label>
      <input 
        pInputText 
        id="nombre" 
        formControlName="nombre"
        placeholder="Nombre completo"
        [class.ng-invalid]="isFieldInvalid('nombre')"
      />
      @if (isFieldInvalid('nombre')) {
        <small class="error">{{ getErrorMessage('nombre') }}</small>
      }
    </div>

    <!-- Email -->
    <div class="field">
      <label for="email">Email *</label>
      <input 
        pInputText 
        id="email" 
        type="email"
        formControlName="email"
        placeholder="email@ejemplo.com"
        [class.ng-invalid]="isFieldInvalid('email')"
      />
      @if (isFieldInvalid('email')) {
        <small class="error">{{ getErrorMessage('email') }}</small>
      }
    </div>

    <!-- Contraseña -->
    <div class="field">
      <label for="password">Contraseña *</label>
      <p-password 
        inputId="password"
        formControlName="password"
        [toggleMask]="true"
        [feedback]="false"
        placeholder="Mínimo 6 caracteres"
        styleClass="w-full"
        [inputStyle]="{ width: '100%' }"
      />
      @if (isFieldInvalid('password')) {
        <small class="error">{{ getErrorMessage('password') }}</small>
      }
    </div>

    <!-- Rol -->
    <div class="field">
      <label for="rol">Rol *</label>
      <select 
        id="rol" 
        formControlName="rol"
        [class.ng-invalid]="isFieldInvalid('rol')"
      >
        @for (role of roles; track role.value) {
          <option [value]="role.value">{{ role.label }}</option>
        }
      </select>
      @if (isFieldInvalid('rol')) {
        <small class="error">{{ getErrorMessage('rol') }}</small>
      }
    </div>

    <!-- Botones -->
    <div class="form-actions">
      <p-button 
        label="Cancelar" 
        icon="pi pi-times" 
        (onClick)="closeDialog()"
        [text]="true"
        severity="secondary"
      />
      <p-button 
        label="Crear" 
        icon="pi pi-check" 
        type="submit"
        [disabled]="userForm.invalid"
      />
    </div>
  </form>
</p-dialog>
